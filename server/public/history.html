<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>BOZZ TRADE Realtime Demo</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body {
            font-family: sans-serif;
            margin: 20px;
            background: #f5f6fa;
        }

        h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            max-width: 1000px;
            margin: 10px auto;
            background: #fff;
        }

        th,
        td {
            border: 1px solid #dcdde1;
            padding: 8px;
            text-align: center;
        }

        th {
            background: #f1f2f6;
            font-weight: 600;
        }

        tr:nth-child(even) {
            background: #f9f9f9;
        }

        .profit {
            color: #2ecc71;
            font-weight: bold;
        }

        .loss {
            color: #e84118;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <h2>Histori Trade & Sinyal - BOZZ TRADE</h2>
    <table>
        <thead>
            <tr>
                <th>Time</th>
                <th>Side</th>
                <th>Open</th>
                <th>Target/TP</th>
                <th>Status</th>
                <th>Profit/Loss</th>
            </tr>
        </thead>
        <tbody id="history"></tbody>
    </table>
    <script>
        const tbody = document.getElementById('history');
        const trades = {};
        const socket = io();

        // Load history
        fetch('/api/history').then(r => r.json()).then(data => {
            data.forEach(trade => {
                const row = document.createElement('tr');
                row.id = 'trade-' + trade.id;
                row.innerHTML = `<td>${trade.time}</td><td>${trade.side}</td><td>${trade.openPrice.toFixed(2)}</td><td>${trade.targetPrice.toFixed(2)}</td><td>Closed</td><td class="${trade.result >= 0 ? 'profit' : 'loss'}">${trade.result.toFixed(2)}</td>`;
                tbody.prepend(row);
            });
        });

        // New Signal
        socket.on('newSignal', sig => {
            const row = document.createElement('tr');
            row.id = 'signal-' + sig.time;
            row.innerHTML = `<td>${sig.time}</td><td>${sig.side}</td><td>${sig.price.toFixed(2)}</td><td>${sig.target.toFixed(2)}</td><td>Signal</td><td>-</td>`;
            tbody.prepend(row);
        });

        // Trade opened
        socket.on('tradeOpened', trade => {
            const row = document.createElement('tr');
            row.id = 'trade-' + trade.id;
            trades[trade.id] = row;
            row.innerHTML = `<td>${trade.time}</td><td>${trade.side}</td><td>${trade.openPrice.toFixed(2)}</td><td>${trade.targetPrice.toFixed(2)}</td><td>Open</td><td>-</td>`;
            tbody.prepend(row);
        });

        // Trade update
        socket.on('tradeUpdate', trade => {
            const row = trades[trade.id];
            if (row) row.innerHTML = `<td>${trade.time}</td><td>${trade.side}</td><td>${trade.openPrice.toFixed(2)}</td><td>${trade.targetPrice.toFixed(2)}</td><td>Open</td><td class="${trade.unrealized >= 0 ? 'profit' : 'loss'}">${trade.unrealized.toFixed(2)}</td>`;
        });

        // Trade closed
        socket.on('tradeClosed', trade => {
            const row = trades[trade.id];
            if (row) row.innerHTML = `<td>${trade.time}</td><td>${trade.side}</td><td>${trade.openPrice.toFixed(2)}</td><td>${trade.targetPrice.toFixed(2)}</td><td>Closed</td><td class="${trade.result >= 0 ? 'profit' : 'loss'}">${trade.result.toFixed(2)}</td>`;
        });
    </script>
</body>

</html>