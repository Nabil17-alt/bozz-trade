<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>BOZZ TRADE Live Demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="/socket.io/socket.io.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #1e1e2f;
            --text-color: #f5f5f5;
            --accent-color: #4e9af1;
            --profit-color: #2ecc71;
            --loss-color: #e84118;
            --table-bg: #2c2c3c;
            --table-header: #3a3a50;
            --signal-color: #f1c40f;
            --buy-color: #2ecc71;
            --sell-color: #e84118;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            background: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            padding: 20px;
        }

        h2 {
            text-align: center;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 20px;
        }

        .chart-wrapper {
            flex: 1 1 48%;
            height: 400px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            background: #000;
        }

        .table-wrapper {
            flex: 1 1 48%;
            max-height: 400px;
            overflow-y: auto;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            background: var(--table-bg);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 8px 12px;
            text-align: center;
            transition: all 0.3s ease;
            font-size: 0.85rem;
        }

        th {
            background: var(--table-header);
            font-weight: 600;
        }

        tr {
            border-bottom: 1px solid #3d3d50;
        }

        tr:hover {
            background: rgba(78, 154, 241, 0.1);
        }

        .profit {
            color: var(--profit-color);
            font-weight: 600;
        }

        .loss {
            color: var(--loss-color);
            font-weight: 600;
        }

        .badge {
            padding: 2px 6px;
            border-radius: 6px;
            font-size: 0.7rem;
            background: #444;
            margin: 0 2px;
        }

        .badge.buy {
            background: var(--buy-color);
            color: #fff;
        }

        .badge.sell {
            background: var(--sell-color);
            color: #fff;
        }

        .filter-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-bar select {
            padding: 6px 10px;
            border-radius: 6px;
            border: none;
            background: #333;
            color: #fff;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .filter-bar select:hover {
            background: var(--accent-color);
        }

        @media(max-width:1024px) {
            .container {
                flex-direction: column;
            }

            .chart-wrapper,
            .table-wrapper {
                flex: 1 1 100%;
            }
        }
    </style>
</head>

<body>

    <h2>BOZZ TRADE Live Demo</h2>

    <div class="filter-bar">
        <select id="symbol-filter">
            <option value="all">All Symbols</option>
            <option value="BTCUSDT">BTC/USDT</option>
            <option value="XAUUSDT">XAU/USDT</option>
        </select>
        <select id="tf-filter">
            <option value="all">All Timeframes</option>
            <option value="5m">5m</option>
            <option value="15m">15m</option>
            <option value="1h">1h</option>
            <option value="4h">4h</option>
        </select>
    </div>

    <div class="container">
        <div class="chart-wrapper" id="btc-chart"></div>
        <div class="table-wrapper">
            <h3 style="text-align:center;padding:10px 0;">BTC/USDT Trades & Signals</h3>
            <table>
                <thead>
                    <tr>
                        <th>TF</th>
                        <th>Time</th>
                        <th>Side</th>
                        <th>Open</th>
                        <th>Target</th>
                        <th>Status</th>
                        <th>P/L</th>
                    </tr>
                </thead>
                <tbody id="btc-history"></tbody>
            </table>
        </div>
    </div>

    <div class="container" style="margin-top:20px;">
        <div class="chart-wrapper" id="xau-chart"></div>
        <div class="table-wrapper">
            <h3 style="text-align:center;padding:10px 0;">XAU/USDT Trades & Signals</h3>
            <table>
                <thead>
                    <tr>
                        <th>TF</th>
                        <th>Time</th>
                        <th>Side</th>
                        <th>Open</th>
                        <th>Target</th>
                        <th>Status</th>
                        <th>P/L</th>
                    </tr>
                </thead>
                <tbody id="xau-history"></tbody>
            </table>
        </div>
    </div>

    <!-- TradingView Widget -->
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script>
        function createWidget(containerId, symbol) {
            new TradingView.widget({
                autosize: true,
                symbol: symbol,
                interval: "5",
                timezone: "Etc/UTC",
                theme: "dark",
                style: "1",
                locale: "en",
                toolbar_bg: "#1e1e2f",
                enable_publishing: false,
                allow_symbol_change: true,
                container_id: containerId
            });
        }

        createWidget("btc-chart", "BINANCE:BTCUSDT");
        createWidget("xau-chart", "OANDA:XAUUSD");
    </script>

    <script>
        const btcTbody = document.getElementById('btc-history');
        const xauTbody = document.getElementById('xau-history');
        const trades = { BTCUSDT: {}, XAUUSDT: {} };
        const socket = io();

        const symbolFilter = document.getElementById('symbol-filter');
        const tfFilter = document.getElementById('tf-filter');

        function renderRow(trade, tbody) {
            const row = document.createElement('tr');
            row.id = `${trade.symbol}-${trade.id || trade.time}`;
            const sideBadge = `<span class="badge ${trade.side === 'Buy' ? 'buy' : 'sell'}">${trade.side}</span>`;
            row.innerHTML = `<td>${trade.tf}</td><td>${trade.time}</td><td>${sideBadge}</td><td>${trade.openPrice.toFixed(2)}</td><td>${trade.targetPrice?.toFixed(2) || '-'}</td><td>${trade.status}</td><td class="${trade.result >= 0 ? 'profit' : 'loss'}">${trade.result?.toFixed(2) || trade.unrealized?.toFixed(2) || '-'}</td>`;
            tbody.prepend(row);
            return row;
        }

        // Load initial history
        ['BTCUSDT', 'XAUUSDT'].forEach(symbol => {
            fetch(`/api/history/${symbol}`).then(r => r.json()).then(data => {
                const tbody = symbol === 'BTCUSDT' ? btcTbody : xauTbody;
                data.forEach(trade => {
                    trade.symbol = symbol;
                    trade.tf = trade.tf || '5m';
                    trade.status = 'Closed';
                    renderRow(trade, tbody);
                });
            });
        });

        // Socket.io events
        socket.on('newSignal', sig => {
            const tbody = sig.symbol === 'BTCUSDT' ? btcTbody : xauTbody;
            if (symbolFilter.value !== 'all' && symbolFilter.value !== sig.symbol) return;
            if (tfFilter.value !== 'all' && tfFilter.value !== sig.tf) return;
            sig.symbol = sig.symbol;
            sig.tf = sig.tf;
            sig.status = 'Signal';
            renderRow(sig, tbody);
        });

        socket.on('tradeOpened', trade => {
            const tbody = trade.symbol === 'BTCUSDT' ? btcTbody : xauTbody;
            trade.status = 'Open';
            trades[trade.symbol][trade.id] = renderRow(trade, tbody);
        });

        socket.on('tradeUpdate', trade => {
            const row = trades[trade.symbol][trade.id];
            if (row) {
                const plCell = row.cells[6];
                plCell.textContent = trade.unrealized.toFixed(2);
                plCell.className = trade.unrealized >= 0 ? 'profit' : 'loss';
            }
        });

        socket.on('tradeClosed', trade => {
            const row = trades[trade.symbol][trade.id];
            if (row) {
                row.cells[5].textContent = 'Closed';
                const plCell = row.cells[6];
                plCell.textContent = trade.result.toFixed(2);
                plCell.className = trade.result >= 0 ? 'profit' : 'loss';
            }
        });
    </script>
</body>

</html>