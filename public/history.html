<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>BOZZ TRADE Live Demo</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body {
            font-family: sans-serif;
            margin: 20px;
            background: #f5f6fa;
        }

        h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            max-width: 1000px;
            margin: 10px auto;
            background: #fff;
        }

        th,
        td {
            border: 1px solid #dcdde1;
            padding: 8px;
            text-align: center;
        }

        th {
            background: #f1f2f6;
            font-weight: 600;
        }

        tr:nth-child(even) {
            background: #f9f9f9;
        }

        .profit {
            color: #2ecc71;
            font-weight: bold;
        }

        .loss {
            color: #e84118;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <h2>BTC/USDT Trade & Signal</h2>
    <table>
        <thead>
            <tr>
                <th>TF</th>
                <th>Time</th>
                <th>Side</th>
                <th>Open</th>
                <th>Target</th>
                <th>Status</th>
                <th>P/L</th>
            </tr>
        </thead>
        <tbody id="btc-history"></tbody>
    </table>

    <h2>XAU/USDT Trade & Signal</h2>
    <table>
        <thead>
            <tr>
                <th>TF</th>
                <th>Time</th>
                <th>Side</th>
                <th>Open</th>
                <th>Target</th>
                <th>Status</th>
                <th>P/L</th>
            </tr>
        </thead>
        <tbody id="xau-history"></tbody>
    </table>

    <script>
        const btcTbody = document.getElementById('btc-history');
        const xauTbody = document.getElementById('xau-history');
        const trades = { BTCUSDT: {}, XAUUSDT: {} };
        const socket = io();

        // Load history
        ['BTCUSDT', 'XAUUSDT'].forEach(symbol => {
            fetch(`/api/history/${symbol}`).then(r => r.json()).then(data => {
                const tbody = symbol === 'BTCUSDT' ? btcTbody : xauTbody;
                data.forEach(trade => {
                    const row = document.createElement('tr');
                    row.id = `${symbol}-${trade.id}`;
                    row.innerHTML = `<td>${trade.tf}</td><td>${trade.time}</td><td>${trade.side}</td><td>${trade.openPrice.toFixed(2)}</td><td>${trade.targetPrice.toFixed(2)}</td><td>Closed</td><td class="${trade.result >= 0 ? 'profit' : 'loss'}">${trade.result.toFixed(2)}</td>`;
                    tbody.prepend(row);
                });
            });
        });

        // Socket.io events
        socket.on('newSignal', sig => {
            const tbody = sig.symbol === 'BTCUSDT' ? btcTbody : xauTbody;
            const row = document.createElement('tr');
            row.id = `signal-${sig.symbol}-${sig.time}`;
            row.innerHTML = `<td>${sig.tf}</td><td>${sig.time}</td><td>${sig.side}</td><td>${sig.price.toFixed(2)}</td><td>${sig.target.toFixed(2)}</td><td>Signal</td><td>-</td>`;
            tbody.prepend(row);
        });

        socket.on('tradeOpened', trade => {
            const tbody = trade.symbol === 'BTCUSDT' ? btcTbody : xauTbody;
            const row = document.createElement('tr');
            row.id = `${trade.symbol}-${trade.id}`;
            trades[trade.symbol][trade.id] = row;
            row.innerHTML = `<td>${trade.tf}</td><td>${trade.time}</td><td>${trade.side}</td><td>${trade.openPrice.toFixed(2)}</td><td>${trade.targetPrice.toFixed(2)}</td><td>Open</td><td>-</td>`;
            tbody.prepend(row);
        });

        socket.on('tradeUpdate', trade => {
            const row = trades[trade.symbol][trade.id];
            if (row) row.innerHTML = `<td>${trade.tf}</td><td>${trade.time}</td><td>${trade.side}</td><td>${trade.openPrice.toFixed(2)}</td><td>${trade.targetPrice.toFixed(2)}</td><td>Open</td><td class="${trade.unrealized >= 0 ? 'profit' : 'loss'}">${trade.unrealized.toFixed(2)}</td>`;
        });

        socket.on('tradeClosed', trade => {
            const row = trades[trade.symbol][trade.id];
            if (row) row.innerHTML = `<td>${trade.tf}</td><td>${trade.time}</td><td>${trade.side}</td><td>${trade.openPrice.toFixed(2)}</td><td>${trade.targetPrice.toFixed(2)}</td><td>Closed</td><td class="${trade.result >= 0 ? 'profit' : 'loss'}">${trade.result.toFixed(2)}</td>`;
        });
    </script>
</body>

</html>